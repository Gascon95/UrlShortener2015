<!DOCTYPE html>
<html>
<head>
    <title>CSV update</title>
    <script src="js/sockjs-0.3.4.js"></script>
    <script src="js/stomp.js"></script>
    <script type="text/javascript">
        var stompClient = null;


        function connect() {
            var socket = new SockJS('/uploader');
            stompClient = Stomp.over(socket);
            stompClient.connect({}, function(frame) {
                console.log('Connected: ' + frame);
                stompClient.subscribe('/user/queue/urlUploads', function(update){
					console.log('Aqui llego');
                    showUpdate(JSON.parse(update.body).status);
                });
            });
        }

        function disconnect() {
            if (stompClient != null) {
                stompClient.disconnect();
            }
            console.log("Disconnected");
        }

        function showUpdate(message) {
            var response = document.getElementById('response');
            var p = document.createElement('p');
            p.style.wordWrap = 'break-word';
            p.appendChild(document.createTextNode(message));
            response.appendChild(p);
        }
        
        /*function sendForm(form) {
			var urls = form.split(",");
			for(i=0; i<urls.lentgth;i++){
				var url = urls[i];
				stompclient.send("/app/uploader", {}, JSON.stringify({ 'url': url }));
			}
		}*/
		
    </script>
</head>
<body onload="connect()">
<noscript><h2 style="color: #ff0000">Seems your browser doesn't support Javascript! Websocket relies on Javascript being enabled. Please enable
    Javascript and reload this page!</h2></noscript>
<div>
    <div id="conversationDiv">
        <p id="response"></p>
    </div>
</div>
</body>
</html>
